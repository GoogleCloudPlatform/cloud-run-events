# Copyright 2019 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
{{ replace_with 0 "generated_header" }}

apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  labels:
    events.cloud.google.com/release: devel
    events.cloud.google.com/crd-install: "true"
  name: pullsubscriptions.internal.events.cloud.google.com
spec:
  group: internal.events.cloud.google.com
  names:
    categories:
    - all
    - knative
    - pubsub
    kind: PullSubscription
    plural: pullsubscriptions
  scope: Namespaced
  subresources:
    status: {}
  preserveUnknownFields: false
  {{- replace_with 2 "conversion_webhook" }}
  additionalPrinterColumns:
    {{- replace_with 4 "ready_reason_age" }}
  versions:
    - name: v1alpha1
      served: true
      storage: true
    - name: v1beta1
      served: true
      storage: false
  # All versions happen to have the same schema today. They will likely diverge in the future.
  validation:
    openAPIV3Schema:
      type: object
      properties:
        spec:
          type: object
          required:
            - sink
            - topic
          properties:
            {{- replace_with 12 "pubsub_spec" }}
            {{- replace_with 12 "topic" }}
            ackDeadline:
              type: string
              description: >
                The default maximum time after a subscriber receives a message before the subscriber
                should acknowledge the message. Defaults to `30s`. Valid time units are `s`, `m`,
                `h`. The minimum deadline you can specify is 0 seconds. The maximum deadline you can
                specify is 600 seconds (10 minutes).
            retainAckedMessages:
              type: boolean
              description: >
                Whether to retain acknowledged messages. If true, acknowledged messages will not be
                expunged until they fall out of the RetentionDuration window.
            retentionDuration:
              type: string
              description: >
                How long to retain messages in backlog, from the time of publish. If
                retainAckedMessages is true, this duration affects the retention of acknowledged
                messages, otherwise only unacknowledged messages are retained. Defaults to 7 days
                (`168h`). Cannot be longer than 7 days or shorter than 10 minutes. Valid time units
                are `s`, `m`, `h`.
            transformer:
              {{- replace_with 14 "destination" }}
            mode:
              type: string
              enum:
                - CloudEventsBinary
                - CloudEventsStructured
                - PushCompatible
              description: >
                Mode defines the encoding and structure of the payload of when this PullSubscription
                invokes the sink. Default is CloudEventsBinary.
            adapterType:
              type: string
              description: >
                AdapterType determines the type of receive adapter that a PullSubscription uses.
        status:
          type: object
          properties:
            {{- replace_with 12 "pubsub_status" }}
            transformerUri:
              type: string
              description: >
                The URI of the active transformer configured for this PullSubscription.
            subscriptionId:
              type: string
              description: >
                The ID of the PullSubscription created in GCP Pub/Sub.
